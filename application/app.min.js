let article_array,dataSet,page=0,pos_focus=0,tabindex_i=-0,window_status="article-list",panels=["All"],current_panel=0;$(document).ready(function(){function a(e){let n=new XMLHttpRequest;n.open("GET",e),n.timeout=4e3,n.responseType="json",n.send(),n.ontimeout=function(s){toaster("timeout please wait I try another source"),a("https://notabug.org/bananaphone/bhstore/src/master/data.json")},n.onload=function(){200!=n.status&&toaster(`Error ${n.status}: ${n.statusText}`),403==n.status&&(toaster("database not found try another"),a("https://notabug.org/bananaphone/bhstore/src/master/data.json")),200==n.status&&(dataSet=n.response,s(),t(),$("div#message-box").css("display","none"))},n.onprogress=function(a){a.lengthComputable},n.onerror=function(){toaster("Request failed, please try later.")}}function s(){dataSet.apps.forEach(function(a,s){let t=dataSet.apps[s],e=t.name,n=t.description,i=t.download.url,o=t.git_repo,c=t.meta.categories,r=c.toString().replace(","," "),l=t.author,p=t.icon,d=t.license,u=t.type,f="<div class='meta-data'><div><span>Author </span>"+l+"</div><div><span>License </span>"+d+"</div><div><span>Type </span>"+u+"</div></div>",v="data-download ='"+i+"' data-url ='"+o+"'",b=$("<article class= 'All "+r+"' "+v+"><div class='icon'><img src='"+p+"'></div><div class='channel'>"+r+"</div><h1>"+e+"</h1><div class='summary'>"+n+"</div>"+f+"</article>");$("div#app-panels").append(b)}),e()}function t(){$.each(dataSet.categories,function(a,s){panels.push(a)}),$("div#navigation").append("<div>"+panels[0]+"</div>")}function e(){$("div#app-panels article").removeAttr("tabindex"),$("div#app-panels article").filter(":visible").each(function(a){$(this).prop("tabindex",a)}),article_array=$("div#app-panels article").filter(":visible"),n(),$("body").find("article[tabindex = 0]").focus()}function n(){let a=$("div#app-panels");a.find("article tabindex").sort(function(a,s){return s-a}).appendTo(a)}function i(a){$("article").css("display","none"),$("article."+a).css("display","block"),$("div#app-panels article").find([tabindex="0"]).focus()}function o(a){"left"==a&&current_panel>0&&(current_panel--,$("div#navigation div").text(panels[current_panel]),i(panels[current_panel]),e(),pos_focus=0),"right"==a&&current_panel<panels.length-1&&(current_panel++,$("div#navigation div").text(panels[current_panel]),i(panels[current_panel]),e(),pos_focus=0)}function c(a){if("article-list"==window_status){$(":focus")[0];if("+1"==a&&pos_focus<article_array.length-1&&(pos_focus++,pos_focus<=article_array.length)){let a=$(":focus")[0].offsetTop+20;window.scrollTo({top:a,left:100,behavior:"smooth"});let s=article_array[pos_focus];s.focus()}if("-1"==a&&pos_focus>0&&(pos_focus--,pos_focus>=0)){let a=article_array[pos_focus];a.focus();let s=$(":focus")[0].offsetTop;window.scrollTo({top:s+20,behavior:"smooth"})}}}function r(){let a=$(":focus");$("article").css("display","none"),$("div#navigation").css("display","none"),$("div#app-panels").css("margin","0 0 0 0"),a.css("display","block"),$("div.summary").css("display","block"),$("div.meta-data").css("display","block"),$("div.icon").css("display","block"),$("div.channel").css("display","none"),$("div#button-bar").css("display","block"),window_status="single-article"}function l(){navigator.spatialNavigationEnabled=!1,$("div#app-panels").css("margin","30px 0 0 0");$(":focus");$("div#navigation").css("display","block"),$("div#app-panels").css("display","block"),$("div.summary").css("display","none"),$("div.meta-data").css("display","none"),$("div.channel").css("display","block"),$("div.icon").css("display","none");let a=article_array[pos_focus];a.focus(),$("div#button-bar").css("display","none"),window.scrollTo(0,$(a).offset().top),$("div#source-page").css("display","none"),$("div#source-page iframe").attr("src",""),window_status="article-list"}function p(){let a=article_array[pos_focus],s=$(a).data("download");window.location.assign(s),notify("Message","App downloaded",!1)}function d(){let a=article_array[pos_focus],s=$(a).data("url");$("div#app-panels").css("display","none"),$("div#source-page").css("display","block"),$("div#source-page iframe").attr("src",s),$("div#button-bar").css("display","none"),window_status="source-page",navigator.spatialNavigationEnabled=!0}function u(a){switch(a.key){case"Enter":r();break;case"ArrowDown":c("+1");break;case"ArrowUp":c("-1");break;case"ArrowLeft":o("left");break;case"ArrowRight":o("right");break;case"SoftLeft":"single-article"==window_status&&d();break;case"SoftRight":"single-article"==window_status&&p();break;case"Backspace":if(a.preventDefault(),"single-article"==window_status||"source-page"==window_status)return void l();"article-list"==window_status&&window.close()}}check_iconnection(),a("https://banana-hackers.gitlab.io/store-db/data.json"),document.addEventListener("keydown",u)});